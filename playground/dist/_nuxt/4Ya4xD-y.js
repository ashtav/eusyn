import{_ as V}from"./B1-_8bdd.js";import{_ as j}from"./BNsV2UJy.js";import{_ as U}from"./Qb3X7RIX.js";import{r as D,_ as E,a as R,c as L,d as a,p as S,n as q,x as K,y as O,e as g,f as G,g as J,j as Q,m as Z,t as z,k as ee}from"./B-NeRa6q.js";import"./BTzyvnay.js";const te={setup(){const n=D(!1),f=D({width:0,height:0});let p={x:null,y:null,size:null,minCropSize:150},r,s,e,d=!1,x=!1,m={x:0,y:0,ox:0,oy:0};const M=0;let C,h;const A=()=>{const c=e.offsetLeft,t=e.offsetTop,o=e.offsetWidth,i=e.offsetHeight,_=document.createElement("canvas"),v=_.getContext("2d");return _.width=o,_.height=i,v.clearRect(0,0,o,i),v.drawImage(r,c,t,o,i,0,0,o,i),_.toDataURL()},B=()=>{if(C){const c=A();C(c),n.value=!1}},W=c=>{document.onkeydown=t=>{(t.key=="Escape"||t.key=="Esc")&&n.value&&(t.preventDefault(),n.value=!1),t.key=="Enter"&&n.value&&(t.preventDefault(),B())}},b=(c,t,o)=>{s.clearRect(0,0,r.width,r.height),s.translate(r.width/2,r.height/2),s.rotate(M*Math.PI/180),s.drawImage(c,-t/2,-o/2,t,o),s.setTransform(1,0,0,1,0,0),s.fillStyle="rgba(0, 0, 0, 0.6)",s.fillRect(0,0,r.width,e.offsetTop),s.fillRect(0,e.offsetTop+e.offsetHeight,r.width,r.height-(e.offsetTop+e.offsetHeight)),s.fillRect(0,e.offsetTop,e.offsetLeft,e.offsetHeight),s.fillRect(e.offsetLeft+e.offsetWidth,e.offsetTop,r.width-(e.offsetLeft+e.offsetWidth),e.offsetHeight),f.value={width:e.offsetWidth,height:e.offsetHeight}},H=c=>{e.style.width=`${c}px`,e.style.height=`${c}px`},Y=(c,t,o)=>{const i=Math.min(t,o)*.7,_=p.size!==null?p.size:i;p.x===null&&p.y===null&&(e.style.left=`${t/2-_/2}px`,e.style.top=`${o/2-_/2}px`),H(_),b(c,t,o);const v=l=>{m={x:l.clientX,y:l.clientY,ox:l.clientX-e.offsetLeft,oy:l.clientY-e.offsetTop},p.x=m.x,p.y=m.y};e.onmousedown=l=>{d=!0,v(l)},document.onmouseup=l=>{d=!1,v(l)},document.onmousemove=l=>{if(d){let y=l.clientX-m.ox,w=l.clientY-m.oy;y=Math.max(0,Math.min(y,t-e.offsetWidth)),w=Math.max(0,Math.min(w,o-e.offsetHeight)),e.style.left=`${y}px`,e.style.top=`${w}px`,x||(x=!0,requestAnimationFrame(()=>{b(c,t,o),x=!1}))}},e.onwheel=l=>{l.preventDefault();const y=l.deltaY>0?-10:10,w=e.offsetLeft,X=e.offsetTop,k=e.offsetWidth,F=l.clientX-e.getBoundingClientRect().left,N=l.clientY-e.getBoundingClientRect().top;let u=k+y;u=Math.max(p.minCropSize,Math.min(u,Math.min(t,o))),p.size=u;let I=w-(u-k)*(F/k),T=X-(u-k)*(N/k);I=Math.max(0,Math.min(I,t-u)),T=Math.max(0,Math.min(T,o-u)),H(u),e.style.left=`${I}px`,e.style.top=`${T}px`,b(c,t,o)}},P=(c,t,o)=>{if(r=document.getElementById("__canvas"),s=r.getContext("2d"),e=document.getElementById("__croparea"),!r||!s){console.error("Canvas or context not found!");return}const i=Math.min(window.innerWidth,window.innerHeight)*.7;t>o?t>i&&(o*=i/t,t=i):o>i&&(t*=i/o,o=i),r.width=t,r.height=o,s.drawImage(c,0,0,t,o),s.fillStyle="rgba(0, 0, 0, 0.5)",s.fillRect(0,0,r.width,r.height),Y(c,t,o)};return{show:n,init:c=>{n.value=!0,W(),C=c.onCrop;const t=new Image;t.src=h??c.data,h==null?h=t.src:h!=c.data&&(t.src=c.data,h=t.src,p={x:null,y:null,size:null,minCropSize:150}),t.onload=()=>{const o=t.width,i=t.height;P(t,o,i)}},doCrop:B}}},$=n=>(K("data-v-938066d1"),n=n(),O(),n),oe={class:"canvas"},ne=$(()=>a("canvas",{id:"__canvas"},null,-1)),se=$(()=>a("div",{id:"__croparea"},null,-1)),re={class:"text-white text-center small mt-3"},ce=$(()=>a("br",null,null,-1)),le=$(()=>a("div",{class:"backdrop"},null,-1));function ie(n,f,p,r,s,e){return R(),L("div",{class:q(["cropper",{show:r.show}])},[a("div",oe,[ne,se,a("div",re,[S(" Use the scroll wheel on the mouse to resize the crop area. "),ce,S(" Press "),a("code",{class:"cursor-pointer",onClick:f[0]||(f[0]=(...d)=>r.doCrop&&r.doCrop(...d))},"Enter"),S(" to crop and "),a("code",{class:"cursor-pointer",onClick:f[1]||(f[1]=d=>r.show=!1)},"Esc"),S(" to cancel. ")])]),le],2)}const ae=E(te,[["render",ie],["__scopeId","data-v-938066d1"]]),pe={setup(){return{}},data(){return{preview:"",image:{}}},methods:{handleFile(n){if(n.files.length!=0&&(this.image=n.files[0],this.preview=this.image.data),n.errors&&n.errors.length>0){this.$toast.error(n.errors[0].message);return}console.log("Selected file:",n)},onCrop(){const n=this.$refs.cropper;n==null||n.init({data:this.image.data,onCrop:f=>{f&&(this.preview=f)}})}}},fe={class:"row"},de={class:"col-6 space-y-3"},me={style:{width:"350px"}},_e=["src"],ue={class:"ps-0"};function he(n,f,p,r,s,e){const d=V,x=j,m=U,M=ee,C=Z,h=ae;return R(),L("div",null,[g(d,{title:"Cropper"}),a("div",fe,[a("div",de,[g(x,{onSelect:e.handleFile},null,8,["onSelect"]),g(m,{code:`<Cropper ref="cropper" />\r
<Button icon="ti-crop" @click="onCrop" />`}),g(m,{class:"mt-2 mb-5",code:`onCrop() {\r
    const cropper = this.$refs.cropper as any\r
    cropper?.init({\r
        data: <your-base-64-image>, onCrop: (result?: string) => {\r
            \r
        }\r
    })\r
}`})]),s.image.data?(R(),G(C,{key:0,gap:15,class:"pos-relative"},{default:J(()=>[a("div",me,[a("img",{src:s.preview,alt:"",class:"rounded mb-3 d-block",style:{"object-fit":"cover"}},null,8,_e),a("code",ue,z(s.image.name)+" | "+z(s.image.type)+" | "+z(s.image.size)+" | "+z(s.image.dimension),1)]),g(M,{theme:"btn pos-absolute t-10 l-20",icon:"hgi-crop",onClick:e.onCrop},null,8,["onClick"])]),_:1})):Q("",!0)]),g(h,{ref:"cropper"},null,512)])}const ke=E(pe,[["render",he]]);export{ke as default};
