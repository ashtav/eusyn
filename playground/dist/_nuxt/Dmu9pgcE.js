import{_ as P}from"./B8tWdb7r.js";import{r as D,o as S,k as W,u as w,_ as Y,a as R,c as C,l as q,e as E,m as I,d as O}from"./B2QH7UNX.js";const H={name:"FileHandler",emits:["select","dragged"],props:{accept:{type:String,default:"image:jpeg,jpg,png"},multiple:{type:Boolean,default:!1},config:{type:Object,default:{maxSize:3,width:[],height:[],label:null,hint:null,required:!1}},draggable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},output:{type:String,default:"base64"}},setup(o,{emit:n,slots:l}){const a=D(""),f=D(null),x=D("");let p=!1;const i=()=>{const s=o.accept.split("|");a.value=s.map(u=>{const[m,r]=u.split(":");return r.split(",").map(h=>`${m}/${h}`).join(", ")}).join(", ")},V=()=>{f.value&&f.value.click()},j=s=>{s.stopPropagation(),s.preventDefault(),!(!o.draggable||!s.dataTransfer||o.disabled)&&(p=s.type==="dragover",s.dataTransfer.dropEffect="copy",n("dragged",{dragover:p}))},L=async s=>{if(s.stopPropagation(),s.preventDefault(),!o.draggable||!s.dataTransfer||o.disabled)return;p=!1;const u=await B(s.dataTransfer.files);n("dragged",{dragover:p,errors:u.errors,files:u.files})},U=s=>1024*1024*s,B=s=>new Promise(async u=>{const m=U(o.config.maxSize??3),r=o.config.width??[],h=o.config.height??[];o.output;let g=[],v=[];const T=Array.from(s).map(e=>new Promise(z=>{let y=!0;e.size>m&&g.push({type:"size",file:e.name,message:`File size must be less than ${w.formatBytes(m)}. Your file size is ${w.formatBytes(e.size)}`}),a.value.includes(e.type)||g.push({type:"format",file:e.name,message:`File type must be ${a.value}. Your file type is ${e.type}`}),y=e.size<=m&&a.value.includes(e.type);const F=new FileReader;F.onload=_=>{var k;if(e.type.startsWith("image/")){let t=new Image;t.src=(k=_.target)==null?void 0:k.result,t.onload=()=>{var b;if(r.length!=0){const d=r[0],c=r.length>1?r[1]:d;(t.width<d||t.width>c)&&(y=!1,g.push({type:"dimension",file:e.name,message:`Your image width must be ${d===c?`exactly ${d}px`:`between ${d}px and ${c}px`}. Current width is ${t.width}px.`}))}if(h.length!=0){const d=h[0],c=h.length>1?h[1]:d;(t.height<d||t.height>c)&&(y=!1,g.push({type:"dimension",file:e.name,message:`Your image height must be ${d===c?`exactly ${d}px`:`between ${d}px and ${c}px`}. Current height is ${t.height}px.`}))}y&&v.push({data:(b=_.target)==null?void 0:b.result,file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size,width:t.width,height:t.height,dimension:`${t.width} x ${t.height}`}),z()}}else if(e.type.startsWith("audio/")||e.type.startsWith("video/")){const t=document.createElement(e.type.startsWith("audio/")?"audio":"video");t.preload="metadata",t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{URL.revokeObjectURL(t.src);const b=e.type.startsWith("video/")&&t instanceof HTMLVideoElement;v.push({data:t.src,file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size,duration:t.duration,width:b?t.videoWidth:void 0,height:b?t.videoHeight:void 0}),z()},t.onerror=()=>{g.push({type:"invalid",file:e.name,message:`Cannot read metadata from ${e.name}.`}),z()}}else y?v.push({data:URL.createObjectURL(e),file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size}):g.push({type:"invalid",file:e.name,message:`The file ${e.name} is not valid due to size or format.`}),z()},F.readAsDataURL(e)}));await Promise.all(T),f.value.value="",u({errors:g,files:v})}),$=async s=>{if(typeof FileReader!="function")n("select",{errors:[{message:"Your browser does not support FileReader.",type:"browser"}]});else{const u=s.target.files,m=await B(u);if(n("select",m),!l.default){const r=m.files;r.length!=0&&(x.value=r[0].name,r.length>1&&(x.value=r[0].name+` and ${r.length-1} other files`))}}};return S(()=>{i()}),W(()=>o.accept,s=>{i()}),{acceptFile:a,fileInput:f,input:x,onClick:V,handeFiles:$,onDragged:j,onDropped:L}}},N={key:0},A=["accept","multiple","disabled"];function M(o,n,l,a,f,x){const p=P;return R(),C("div",{onClick:n[2]||(n[2]=(...i)=>a.onClick&&a.onClick(...i)),onDragover:n[3]||(n[3]=(...i)=>a.onDragged&&a.onDragged(...i)),onDragleave:n[4]||(n[4]=(...i)=>a.onDragged&&a.onDragged(...i)),onDrop:n[5]||(n[5]=(...i)=>a.onDropped&&a.onDropped(...i))},[q(o.$slots,"default"),o.$slots.default?I("",!0):(R(),C("div",N,[E(p,{label:l.config.label,hint:l.config.hint??"Please select file",readonly:"",required:l.config.required,suffix:[{text:"Browse",kbd:!0}],modelValue:a.input,"onUpdate:modelValue":n[0]||(n[0]=i=>a.input=i),disabled:l.disabled},null,8,["label","hint","required","modelValue","disabled"])])),O("input",{type:"file",ref:"fileInput",accept:a.acceptFile,onChange:n[1]||(n[1]=(...i)=>a.handeFiles&&a.handeFiles(...i)),class:"d-none",multiple:l.multiple,disabled:l.disabled},null,40,A)],32)}const K=Y(H,[["render",M]]);export{K as _};
