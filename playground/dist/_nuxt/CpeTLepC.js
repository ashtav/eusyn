import{_ as W}from"./7IzF0dRf.js";import{r as D,o as S,k as Y,u as w,_ as q,a as R,c as C,d as V,l as E,e as I,m as O}from"./DNDMXCnN.js";const H={name:"FileHandler",emits:["select"],props:{accept:{type:String,default:"image:jpeg,jpg,png"},multiple:{type:Boolean,default:!1},config:{type:Object,default:{maxSize:3,width:[],height:[],label:null,hint:null,required:!1}},draggable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(o,{emit:s,slots:d}){const a=D(""),p=D(null),x=D(""),h=D(!1),i=()=>{const n=o.accept.split("|");a.value=n.map(f=>{const[m,r]=f.split(":");return r.split(",").map(g=>`${m}/${g}`).join(", ")}).join(", ")},j=()=>{p.value&&p.value.click()},L=n=>{n.stopPropagation(),n.preventDefault(),!(!o.draggable||!n.dataTransfer||o.disabled)&&(h.value=n.type==="dragover",n.dataTransfer.dropEffect="copy")},U=async n=>{n.stopPropagation(),n.preventDefault(),!(!o.draggable||!n.dataTransfer||o.disabled)&&(h.value=!1,B({target:{files:n.dataTransfer.files}}))},T=n=>1024*1024*n,$=n=>new Promise(async f=>{const m=T(o.config.maxSize??3),r=o.config.width??[],g=o.config.height??[];let u=[],v=[];const P=Array.from(n).map(e=>new Promise(z=>{let y=!0;e.size>m&&u.push({type:"size",file:e.name,message:`File size must be less than ${w.formatBytes(m)}. Your file size is ${w.formatBytes(e.size)}`}),a.value.includes(e.type)||u.push({type:"format",file:e.name,message:`File type must be ${a.value}. Your file type is ${e.type}`}),y=e.size<=m&&a.value.includes(e.type);const F=new FileReader;F.onload=_=>{var k;if(e.type.startsWith("image/")){let t=new Image;t.src=(k=_.target)==null?void 0:k.result,t.onload=()=>{var b;if(r.length!=0){const l=r[0],c=r.length>1?r[1]:l;(t.width<l||t.width>c)&&(y=!1,u.push({type:"dimension",file:e.name,message:`Your image width must be ${l===c?`exactly ${l}px`:`between ${l}px and ${c}px`}. Current width is ${t.width}px.`}))}if(g.length!=0){const l=g[0],c=g.length>1?g[1]:l;(t.height<l||t.height>c)&&(y=!1,u.push({type:"dimension",file:e.name,message:`Your image height must be ${l===c?`exactly ${l}px`:`between ${l}px and ${c}px`}. Current height is ${t.height}px.`}))}y&&v.push({data:(b=_.target)==null?void 0:b.result,file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size,width:t.width,height:t.height,dimension:`${t.width} x ${t.height}`}),z()}}else if(e.type.startsWith("audio/")||e.type.startsWith("video/")){const t=document.createElement(e.type.startsWith("audio/")?"audio":"video");t.preload="metadata",t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{URL.revokeObjectURL(t.src);const b=e.type.startsWith("video/")&&t instanceof HTMLVideoElement;v.push({data:t.src,file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size,duration:t.duration,width:b?t.videoWidth:void 0,height:b?t.videoHeight:void 0}),z()},t.onerror=()=>{u.push({type:"invalid",file:e.name,message:`Cannot read metadata from ${e.name}.`}),z()}}else y?v.push({data:URL.createObjectURL(e),file:e,name:e.name,type:e.type,size:w.formatBytes(e.size),bytes:e.size}):u.push({type:"invalid",file:e.name,message:`The file ${e.name} is not valid due to size or format.`}),z()},F.readAsDataURL(e)}));await Promise.all(P),p.value.value="",f({errors:u,files:v})}),B=async n=>{if(typeof FileReader!="function")s("select",{errors:[{message:"Your browser does not support FileReader.",type:"browser"}]});else{const f=n.target.files,m=await $(f);if(s("select",m),!d.default){const r=m.files;r.length!=0&&(x.value=r[0].name,r.length>1&&(x.value=r[0].name+` and ${r.length-1} other files`))}}};return S(()=>{i()}),Y(()=>o.accept,n=>{i()}),{acceptFile:a,fileInput:p,input:x,dragging:h,onClick:j,handleFiles:B,onDragged:L,onDropped:U}}},N={key:0},A=["accept","multiple","disabled"];function M(o,s,d,a,p,x){const h=W;return R(),C("div",null,[V("div",{onClick:s[2]||(s[2]=(...i)=>a.onClick&&a.onClick(...i)),onDragover:s[3]||(s[3]=(...i)=>a.onDragged&&a.onDragged(...i)),onDragleave:s[4]||(s[4]=(...i)=>a.onDragged&&a.onDragged(...i)),onDrop:s[5]||(s[5]=(...i)=>a.onDropped&&a.onDropped(...i))},[E(o.$slots,"default",{dragged:a.dragging}),o.$slots.default?O("",!0):(R(),C("div",N,[I(h,{label:d.config.label,hint:d.config.hint??"Please select file",readonly:"",required:d.config.required,suffix:[{text:"Browse",kbd:!0}],modelValue:a.input,"onUpdate:modelValue":s[0]||(s[0]=i=>a.input=i),disabled:d.disabled},null,8,["label","hint","required","modelValue","disabled"])])),V("input",{type:"file",ref:"fileInput",accept:a.acceptFile,onChange:s[1]||(s[1]=(...i)=>a.handleFiles&&a.handleFiles(...i)),class:"d-none",multiple:d.multiple,disabled:d.disabled},null,40,A)],32)])}const K=q(H,[["render",M]]);export{K as _};
