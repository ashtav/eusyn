import{_ as V}from"./D5cU2TF1.js";import{_ as U}from"./CLJK8BqD.js";import{_ as j}from"./xE6_nHJ1.js";import{r as D,_ as E,o as R,c as L,a as i,d as z,u as q,p as K,f as O,b as x,y as G,w as J,z as Q,v as Z,t as S,x as ee}from"./DiZFY1gu.js";import"./DBuwMtje.js";const te={setup(){const r=D(!1),f=D({width:0,height:0});let p={x:null,y:null,size:null,minCropSize:150},s,n,e,d=!1,g=!1,m={x:0,y:0,ox:0,oy:0};const b=0;let v,h;const A=()=>{const c=e.offsetLeft,t=e.offsetTop,o=e.offsetWidth,l=e.offsetHeight,_=document.createElement("canvas"),C=_.getContext("2d");return _.width=o,_.height=l,C.clearRect(0,0,o,l),C.drawImage(s,c,t,o,l,0,0,o,l),_.toDataURL()},B=()=>{if(v){const c=A();v(c),r.value=!1}},W=c=>{document.onkeydown=t=>{(t.key=="Escape"||t.key=="Esc")&&r.value&&(t.preventDefault(),r.value=!1),t.key=="Enter"&&r.value&&(t.preventDefault(),B())}},M=(c,t,o)=>{n.clearRect(0,0,s.width,s.height),n.translate(s.width/2,s.height/2),n.rotate(b*Math.PI/180),n.drawImage(c,-t/2,-o/2,t,o),n.setTransform(1,0,0,1,0,0),n.fillStyle="rgba(0, 0, 0, 0.6)",n.fillRect(0,0,s.width,e.offsetTop),n.fillRect(0,e.offsetTop+e.offsetHeight,s.width,s.height-(e.offsetTop+e.offsetHeight)),n.fillRect(0,e.offsetTop,e.offsetLeft,e.offsetHeight),n.fillRect(e.offsetLeft+e.offsetWidth,e.offsetTop,s.width-(e.offsetLeft+e.offsetWidth),e.offsetHeight),f.value={width:e.offsetWidth,height:e.offsetHeight}},H=c=>{e.style.width=`${c}px`,e.style.height=`${c}px`},Y=(c,t,o)=>{const l=Math.min(t,o)*.7,_=p.size!==null?p.size:l;p.x===null&&p.y===null&&(e.style.left=`${t/2-_/2}px`,e.style.top=`${o/2-_/2}px`),H(_),M(c,t,o);const C=a=>{m={x:a.clientX,y:a.clientY,ox:a.clientX-e.offsetLeft,oy:a.clientY-e.offsetTop},p.x=m.x,p.y=m.y};e.onmousedown=a=>{d=!0,C(a)},document.onmouseup=a=>{d=!1,C(a)},document.onmousemove=a=>{if(d){let y=a.clientX-m.ox,w=a.clientY-m.oy;y=Math.max(0,Math.min(y,t-e.offsetWidth)),w=Math.max(0,Math.min(w,o-e.offsetHeight)),e.style.left=`${y}px`,e.style.top=`${w}px`,g||(g=!0,requestAnimationFrame(()=>{M(c,t,o),g=!1}))}},e.onwheel=a=>{a.preventDefault();const y=a.deltaY>0?-10:10,w=e.offsetLeft,X=e.offsetTop,k=e.offsetWidth,F=a.clientX-e.getBoundingClientRect().left,N=a.clientY-e.getBoundingClientRect().top;let u=k+y;u=Math.max(p.minCropSize,Math.min(u,Math.min(t,o))),p.size=u;let I=w-(u-k)*(F/k),T=X-(u-k)*(N/k);I=Math.max(0,Math.min(I,t-u)),T=Math.max(0,Math.min(T,o-u)),H(u),e.style.left=`${I}px`,e.style.top=`${T}px`,M(c,t,o)}},P=(c,t,o)=>{if(s=document.getElementById("__canvas"),n=s.getContext("2d"),e=document.getElementById("__croparea"),!s||!n){console.error("Canvas or context not found!");return}const l=Math.min(window.innerWidth,window.innerHeight)*.7;t>o?t>l&&(o*=l/t,t=l):o>l&&(t*=l/o,o=l),s.width=t,s.height=o,n.drawImage(c,0,0,t,o),n.fillStyle="rgba(0, 0, 0, 0.5)",n.fillRect(0,0,s.width,s.height),Y(c,t,o)};return{show:r,init:c=>{r.value=!0,W(),v=c.onCrop;const t=new Image;t.src=h??c.data,h==null?h=t.src:h!=c.data&&(t.src=c.data,h=t.src,p={x:null,y:null,size:null,minCropSize:150}),t.onload=()=>{const o=t.width,l=t.height;P(t,o,l)}},doCrop:B}}},$=r=>(K("data-v-938066d1"),r=r(),O(),r),oe={class:"canvas"},ne=$(()=>i("canvas",{id:"__canvas"},null,-1)),se=$(()=>i("div",{id:"__croparea"},null,-1)),ce={class:"text-white text-center small mt-3"},re=$(()=>i("br",null,null,-1)),ae=$(()=>i("div",{class:"backdrop"},null,-1));function le(r,f,p,s,n,e){return R(),L("div",{class:q(["cropper",{show:s.show}])},[i("div",oe,[ne,se,i("div",ce,[z(" Use the scroll wheel on the mouse to resize the crop area. "),re,z(" Press "),i("code",{class:"cursor-pointer",onClick:f[0]||(f[0]=(...d)=>s.doCrop&&s.doCrop(...d))},"Enter"),z(" to crop and "),i("code",{class:"cursor-pointer",onClick:f[1]||(f[1]=d=>s.show=!1)},"Esc"),z(" to cancel. ")])]),ae],2)}const ie=E(te,[["render",le],["__scopeId","data-v-938066d1"]]),pe={setup(){return{}},data(){return{preview:"",image:{}}},methods:{handleFile(r){r.files.length!=0&&(this.image=r.files[0],this.preview=this.image.data)},onCrop(){const r=this.$refs.cropper;r==null||r.init({data:this.image.data,onCrop:f=>{f&&(this.preview=f)}})}}},fe={class:"row"},de={class:"col-6"},me={style:{width:"350px"}},_e=["src"],ue={class:"ps-0"};function he(r,f,p,s,n,e){const d=V,g=U,m=j,b=ee,v=Z,h=ie;return R(),L("div",null,[x(d,{title:"Cropper"}),i("div",fe,[i("div",de,[x(g,{onSelect:e.handleFile},null,8,["onSelect"]),x(m,{code:`<Cropper ref="cropper" />\r
<Button icon="ti-crop" @click="onCrop" />`}),x(m,{class:"mt-2 mb-5",code:`onCrop() {\r
    const cropper = this.$refs.cropper as any\r
    cropper?.init({\r
        data: <your-base-64-image>, onCrop: (result?: string) => {\r
            \r
        }\r
    })\r
}`})]),n.image.data?(R(),G(v,{key:0,gap:15,class:"pos-relative"},{default:J(()=>[i("div",me,[i("img",{src:n.preview,alt:"",class:"rounded mb-3 d-block",style:{"object-fit":"cover"}},null,8,_e),i("code",ue,S(n.image.name)+" | "+S(n.image.type)+" | "+S(n.image.size)+" | "+S(n.image.dimension),1)]),x(b,{theme:"btn pos-absolute t-10 l-20",icon:"hgi-crop",onClick:e.onCrop},null,8,["onClick"])]),_:1})):Q("",!0)]),x(h,{ref:"cropper"},null,512)])}const ke=E(pe,[["render",he]]);export{ke as default};
