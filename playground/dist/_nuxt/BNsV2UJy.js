import{_ as R}from"./BTzyvnay.js";import{r as D,o as N,w as A,u as w,_ as E,a as $,c as j,h as U,e as H,j as L,d as M}from"./B-NeRa6q.js";const O={name:"FileHandler",emits:["select","dragged"],props:{accept:{type:String,default:"image:jpeg,jpg,png"},multiple:{type:Boolean,default:!1},config:{type:Object,default:{maxSize:3,width:[],height:[],label:null,hint:null,required:!1}},draggable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},output:{type:String,default:"base64"}},setup(i,{emit:n,slots:d}){const t=D(""),h=D(null),b=D("");let f=!1;const s=()=>{const a=i.accept.split("|");t.value=a.map(u=>{const[g,l]=u.split(":");return l.split(",").map(c=>`${g}/${c}`).join(", ")}).join(", ")},P=()=>{h.value&&h.value.click()},S=a=>{a.stopPropagation(),a.preventDefault(),!(!i.draggable||!a.dataTransfer||i.disabled)&&(f=a.type==="dragover",a.dataTransfer.dropEffect="copy",n("dragged",{dragover:f}))},T=async a=>{if(a.stopPropagation(),a.preventDefault(),!i.draggable||!a.dataTransfer||i.disabled)return;f=!1;const u=await F(a.dataTransfer.files);n("dragged",{dragover:f,errors:u.errors,files:u.files})},Y=a=>1024*1024*a,F=a=>new Promise(async u=>{const g=Y(i.config.maxSize??3),l=i.config.width??[],c=i.config.height??[],B=i.output;let p=[],x=[];const I=Array.from(a).map(e=>new Promise(_=>{let y=!0;e.size>g&&p.push({type:"size",file:e.name,message:`File size must be less than ${w.formatBytes(g)}. Your file size is ${w.formatBytes(e.size)}`}),t.value.includes(e.type)||p.push({type:"format",file:e.name,message:`File type must be ${t.value}. Your file type is ${e.type}`}),y=e.size<=g&&t.value.includes(e.type);const v=new FileReader;v.onload=z=>{var k,C;if(e.type.startsWith("image/")){let r=new Image;r.src=(k=z.target)==null?void 0:k.result,r.onload=()=>{var V;if(l.length!=0){const o=l[0],m=l.length>1?l[1]:o;(r.width<o||r.width>m)&&(y=!1,p.push({type:"dimension",file:e.name,message:`Your image width must be ${o===m?`exactly ${o}px`:`between ${o}px and ${m}px`}. Current width is ${r.width}px.`}))}if(c.length!=0){const o=c[0],m=c.length>1?c[1]:o;(r.height<o||r.height>m)&&(y=!1,p.push({type:"dimension",file:e.name,message:`Your image height must be ${o===m?`exactly ${o}px`:`between ${o}px and ${m}px`}. Current height is ${r.height}px.`}))}y&&x.push({data:B==="file"?e:(V=z.target)==null?void 0:V.result,name:e.name,type:e.type,size:w.formatBytes(e.size),dimension:`${r.width} x ${r.height}`}),_()}}else y?x.push({data:B==="file"?e:(C=z.target)==null?void 0:C.result,name:e.name,type:e.type,size:w.formatBytes(e.size)}):p.push({type:"invalid",file:e.name,message:`The file ${e.name} is not valid due to size or format.`}),_()},v.readAsDataURL(e)}));await Promise.all(I),h.value.value="",u({errors:p,files:x})}),q=async a=>{if(typeof FileReader!="function")n("select",{errors:[{message:"Your browser does not support FileReader.",type:"browser"}]});else{const u=a.target.files,g=await F(u);if(n("select",g),!d.default){const l=g.files;l.length!=0&&(b.value=l[0].name,l.length>1&&(b.value=l[0].name+` and ${l.length-1} other files`))}}};return N(()=>{s()}),A(()=>i.accept,a=>{s()}),{acceptFile:t,fileInput:h,input:b,onClick:P,handeFiles:q,onDragged:S,onDropped:T}}},W={key:0},G=["accept","multiple","disabled"];function J(i,n,d,t,h,b){const f=R;return $(),j("div",{onClick:n[2]||(n[2]=(...s)=>t.onClick&&t.onClick(...s)),onDragover:n[3]||(n[3]=(...s)=>t.onDragged&&t.onDragged(...s)),onDragleave:n[4]||(n[4]=(...s)=>t.onDragged&&t.onDragged(...s)),onDrop:n[5]||(n[5]=(...s)=>t.onDropped&&t.onDropped(...s))},[U(i.$slots,"default"),i.$slots.default?L("",!0):($(),j("div",W,[H(f,{label:d.config.label,hint:d.config.hint??"Please select file",readonly:"",required:d.config.required,suffixs:[{text:"Browse",kbd:!0}],modelValue:t.input,"onUpdate:modelValue":n[0]||(n[0]=s=>t.input=s),disabled:d.disabled},null,8,["label","hint","required","modelValue","disabled"])])),M("input",{type:"file",ref:"fileInput",accept:t.acceptFile,onChange:n[1]||(n[1]=(...s)=>t.handeFiles&&t.handeFiles(...s)),class:"d-none",multiple:d.multiple,disabled:d.disabled},null,40,G)],32)}const X=E(O,[["render",J]]);export{X as _};
